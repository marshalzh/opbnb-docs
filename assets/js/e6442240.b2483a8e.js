"use strict";(self.webpackChunkgreenfield_docs=self.webpackChunkgreenfield_docs||[]).push([[9817],{92376:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>n,metadata:()=>c,toc:()=>l});var r=i(87462),o=(i(67294),i(3905));const n={title:"Piece Store",order:4},a="PieceStore",c={unversionedId:"guide/storage-provider/services/piece-store",id:"guide/storage-provider/services/piece-store",title:"Piece Store",description:"Vision",source:"@site/docs/guide/storage-provider/services/piece-store.md",sourceDirName:"guide/storage-provider/services",slug:"/guide/storage-provider/services/piece-store",permalink:"/opbnb-docs/docs/guide/storage-provider/services/piece-store",draft:!1,editUrl:"https://github.com/bnb-chain/opbnb-docs/docs/guide/storage-provider/services/piece-store.md",tags:[],version:"current",frontMatter:{title:"Piece Store",order:4}},s={},l=[{value:"Vision",id:"vision",level:2},{value:"Goal",id:"goal",level:2},{value:"Overview",id:"overview",level:2},{value:"API Interfaces",id:"api-interfaces",level:3},{value:"Sharding",id:"sharding",level:3},{value:"Compatibile With Multi Object Storage",id:"compatibile-with-multi-object-storage",level:3},{value:"Outlook",id:"outlook",level:3}],d={toc:l};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"piecestore"},"PieceStore"),(0,o.kt)("h2",{id:"vision"},"Vision"),(0,o.kt)("p",null,"Write once, run on every storage service."),(0,o.kt)("h2",{id:"goal"},"Goal"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Vendor-agnostic"),(0,o.kt)("li",{parentName:"ul"},"Production ready"),(0,o.kt)("li",{parentName:"ul"},"High performance"),(0,o.kt)("li",{parentName:"ul"},"High availability")),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"The core function of PieceStore module is to be compatible with multiple object storage or KV storage such as S3, GCS, Azure Blob, Minio, Ceph, IPFS, DiskFile, Memory, etc. Different SP can use different object storage without caring about the underlying implementation."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"SP-piece-store-arch",src:i(76659).Z,width:"2292",height:"1920"})),(0,o.kt)("div",{style:{textAlign:"center"}},">",(0,o.kt)("i",null,"PieceStore Architecture")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/bnb-chain/greenfield-storage-provider/tree/master/store/piecestore"},"PieceStore code")),(0,o.kt)("h3",{id:"api-interfaces"},"API Interfaces"),(0,o.kt)("p",null,"PieceStore provides encapsulating interfaces for upper-layer services to use.\nNow these APIs are called by local pakcage functions. We provide four apis to visit PieceStore as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"func (p *PieceStore) Get(ctx context.Context, key string, offset, limit int64) (io.ReadCloser, error)\n\n// Put one piece to PieceStore\nfunc (p *PieceStore) Put(ctx context.Context, key string, reader io.Reader) error\n\n// Delete one piece in PieceStore\nfunc (p *PieceStore) Delete(ctx context.Context, key string) error\n\n// GetPieceInfo returns piece info in PieceStore\nfunc (p *PieceStore) GetPieceInfo(ctx context.Context, key string) (storage.Object, error)\n")),(0,o.kt)("p",null,"In the future, upper-layer services could visit PieceStore through HTTP, RPC or P2P which is more decentralized."),(0,o.kt)("h3",{id:"sharding"},"Sharding"),(0,o.kt)("p",null,"PieceStore provides sharding function for data high availability. PieceStore uses ",(0,o.kt)("inlineCode",{parentName:"p"},"fnv")," algorithm to shard piece data. If users want to use data sharding, you can configure ",(0,o.kt)("inlineCode",{parentName:"p"},"Shards = a(a is a number which 2 <= a <= 256)")," in config.toml."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note")," The current implementation of sharding can only be used for multiple buckets in one region. The support of multi-region would be added in the future which will be more higher availability."),(0,o.kt)("h3",{id:"compatibile-with-multi-object-storage"},"Compatibile With Multi Object Storage"),(0,o.kt)("p",null,"PieceStore is vendor-agnostic, so it will be compatibile with multi object storage. Now SP supports based storage such as ",(0,o.kt)("inlineCode",{parentName:"p"},"S3, MinIO, DiskFile and Memory"),".\nRecommend using S3 or MinIO in production environment and ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/bnb-chain/greenfield-storage-provider/blob/master/store/piecestore/README.md"},"the releated config document is here"),". Users can experience PieceStore in local by DiskFile or Memory."),(0,o.kt)("p",null,"The common interface is as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},"// ObjectStorage is a common interface that must be implemented if some users want to use an object\n// storage (such as S3, Azure Blob, Minio, OSS, COS, etc)\ntype ObjectStorage interface {\n    // String the description of an object storage\n    String() string\n    // CreateBucket create the bucket if not existed\n    CreateBucket(ctx context.Context) error\n    // GetObject gets data for the given object specified by key\n    GetObject(ctx context.Context, key string, offset, limit int64) (io.ReadCloser, error)\n    // PutObject puts data read from a reader to an object specified by key\n    PutObject(ctx context.Context, key string, reader io.Reader) error\n    // DeleteObject deletes an object\n    DeleteObject(ctx context.Context, key string) error\n\n    // HeadBucket determines if a bucket exists and have permission to access it\n    HeadBucket(ctx context.Context) error\n    // HeadObject returns some information about the object or an error if not found\n    HeadObject(ctx context.Context, key string) (Object, error)\n    // ListObjects lists returns a list of objects\n    ListObjects(ctx context.Context, prefix, marker, delimiter string, limit int64) ([]Object, error)\n    // ListAllObjects returns all the objects as a channel\n    ListAllObjects(ctx context.Context, prefix, marker string) (<-chan Object, error)\n}\n")),(0,o.kt)("h3",{id:"outlook"},"Outlook"),(0,o.kt)("p",null,"PieceStore provides some fundamental functions: wrapped API interfaces, sharding and compatibile with multi object storage. However, there are more functions to be added in the future. "),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Data Cache")),(0,o.kt)("p",null,"PieceStore is combined with object storage, cache is an important component for interacting efficiently between the local client and remote services. Read and write data can be loaded into cache in advance or asynchronously. Using caching technology can significantly reduce the latency of storag operations and increase data throughput compared to interact with remote services directly."),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"GC Module")),(0,o.kt)("p",null,"There will be some useless data stored in remote object storage which will occupy users' data space and generate extra costs. GC module will garbage useless data according to context. This module will reduce users' data space and costs."))}u.isMDXComponent=!0},76659:(e,t,i)=>{i.d(t,{Z:()=>r});const r=i.p+"assets/images/11-SP-Piecestore-Arch-a6b8e2fa5b0539ac91ce69959de66367.jpg"}}]);