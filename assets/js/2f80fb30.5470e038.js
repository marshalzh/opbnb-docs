"use strict";(self.webpackChunkgreenfield_docs=self.webpackChunkgreenfield_docs||[]).push([[5099],{83525:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var i=n(87462),o=(n(67294),n(3905));const a={title:"Permission",order:4},r="Permission",s={unversionedId:"guide/greenfield-blockchain/modules/permission",id:"guide/greenfield-blockchain/modules/permission",title:"Permission",description:"The permission module serves as the foundation for basic permission control management in the Greenfield Storage Network.",source:"@site/docs/guide/greenfield-blockchain/modules/permission.md",sourceDirName:"guide/greenfield-blockchain/modules",slug:"/guide/greenfield-blockchain/modules/permission",permalink:"/opbnb-docs/docs/guide/greenfield-blockchain/modules/permission",draft:!1,editUrl:"https://github.com/bnb-chain/opbnb-docs/docs/guide/greenfield-blockchain/modules/permission.md",tags:[],version:"current",frontMatter:{title:"Permission",order:4}},l={},c=[{value:"Concepts",id:"concepts",level:2},{value:"Terminology",id:"terminology",level:3},{value:"Resource",id:"resource",level:3},{value:"Ownership",id:"ownership",level:3},{value:"Definitions",id:"definitions",level:3},{value:"Revoke",id:"revoke",level:3},{value:"Examples",id:"examples",level:3},{value:"State",id:"state",level:2},{value:"Policy",id:"policy",level:3},{value:"PolicyGroup",id:"policygroup",level:3},{value:"params",id:"params",level:3},{value:"Message",id:"message",level:2},{value:"PutPolicy",id:"putpolicy",level:3},{value:"DeletePolicy",id:"deletepolicy",level:3}],p={toc:c};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,i.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"permission"},"Permission"),(0,o.kt)("p",null,"The permission module serves as the foundation for basic permission control management in the Greenfield Storage Network."),(0,o.kt)("p",null,"All data resources, such as objects, buckets, payment accounts, and groups, require specific permissions to be accessed.\nThese authorizations dictate the actions that can be taken by each account."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note"),": Groups are collections of accounts that share the same permissions, allowing them to be handled as a single entity."),(0,o.kt)("p",null,"Examples of permissions include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Put, List, Get, Delete, Copy, and Execute data objects;"),(0,o.kt)("li",{parentName:"ul"},"Create, Delete, and List buckets"),(0,o.kt)("li",{parentName:"ul"},"Create, Delete, ListMembers, Leave groups"),(0,o.kt)("li",{parentName:"ul"},"Create, Associate payment accounts"),(0,o.kt)("li",{parentName:"ul"},"Grant, Revoke the above permissions")),(0,o.kt)("p",null,"These permissions are linked to both the data resources and the accounts or groups authorized to access them.\nThe group definitions are publicly stored on the Greenfield blockchain, and are currently in plain text.\nHowever, a privacy mode utilizing Zero Knowledge Proof technology is planned for future implementation."),(0,o.kt)("p",null,"Notably, permission operations can be directly executed from BSC, whether through smart contracts or an EOA, further enhancing their convenience."),(0,o.kt)("p",null,"Overall, the interface semantics of the permission module are similar to S3."),(0,o.kt)("h2",{id:"concepts"},"Concepts"),(0,o.kt)("h3",{id:"terminology"},"Terminology"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Resources"),": Buckets, objects, and groups are the primary resources within the Greenfield network that require\npermission authorization. These resources are identified through the Greenfield Resource Name (GRN) in policies."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Actions"),": Each resource within Greenfield has a designated set of operations that can be performed on it. To specify which actions are allowed or denied, an action enum value must be provided."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Principals"),": Accounts or groups that are granted permission to access specific resources and actions can be identified in the policy."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Statements"),": Policies outline the specific details of permissions, including the Effect, ActionList, and Resources."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Effect"),": The Effect sets the outcome when a user requests a particular action, and can be configured as either allow or deny.")),(0,o.kt)("h3",{id:"resource"},"Resource"),(0,o.kt)("p",null,"Greenfield utilizes resources, which are the main entities that can be manipulated.\nBuckets, objects, and groups are all considered resources, and each has its own set of subresources."),(0,o.kt)("p",null,"Bucket subresources consist of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"BucketInfo"),": Allows for modification of specific fields in a bucket, such as ",(0,o.kt)("inlineCode",{parentName:"li"},"IsPublic"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"ReadQuota"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"paymentAccount"),", etc;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Policy"),": Stores permissions information for the bucket;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Objects"),": Every object must be stored within a bucket;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Object ownership"),": Newly uploaded objects are automatically transferred to the bucket owner, regardless of who uploaded them.")),(0,o.kt)("p",null,"Object subresources consist of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"ObjectInfo"),": Allows for modification of certain fields within an object, such as ",(0,o.kt)("inlineCode",{parentName:"li"},"IsPublic"),", etc;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Policy"),": Stores access permissions information for the object.")),(0,o.kt)("p",null,"Group subresources consist of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"GroupInfo"),": Allows for modification of specific fields within a group, such as members, user-meta, etc;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Policy"),": Stores access permissions information for the group;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"GroupMember"),": Any account in Greenfield has the ability to join a group, but a group cannot become a member of another group.")),(0,o.kt)("h3",{id:"ownership"},"Ownership"),(0,o.kt)("p",null,"The resources owner refers to the account that creates the resource. By default, only the resource owner has the permission\nto access its resources."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The resource creator owns the resource."),(0,o.kt)("li",{parentName:"ul"},"Each resource only has one owner and the ownership cannot be transferred once the resource is created."),(0,o.kt)("li",{parentName:"ul"},'There are features that allow an account to "approve" another account to create and upload objects to be owned by the approver, as long as it is within limits.'),(0,o.kt)("li",{parentName:"ul"},"The owner or payment account of the owner pays for the resource.")),(0,o.kt)("h3",{id:"definitions"},"Definitions"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Ownership Permission"),": By default, the owner has all permissions on the resource."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Public or Private Permission"),": By default, the resource is private, only the owner can access the resource. If a resource is public, anyone can access it."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Shared Permission"),": These permissions are managed by the permission module. It usually manages who has permission for which resources.")),(0,o.kt)("p",null,"There are two types of shared permissions: Single Account Permission and Group Permission, which are stored in\ndifferent formats in the blockchain state."),(0,o.kt)("h3",{id:"revoke"},"Revoke"),(0,o.kt)("p",null,"Users can assign one or more permissions as needed. However, when a resource is deleted, its associated permissions\nshould also be removed, even if the user does not initiate the deletion \u2013 this can be managed through clean-up mechanisms.\nIf too many accounts have permission to delete an object, the processing time required may become excessively lengthy for\na single transaction to handle."),(0,o.kt)("h3",{id:"examples"},"Examples"),(0,o.kt)("p",null,"Let's say Greenfield has two accounts, Bob(0x1110) and Alice(0x1111). A basic example scenario would be:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Bob uploaded a picture named ",(0,o.kt)("inlineCode",{parentName:"li"},"avatar.jpg"),' into a bucket named "profile";'),(0,o.kt)("li",{parentName:"ul"},"Bob grants the ",(0,o.kt)("inlineCode",{parentName:"li"},"GetObject")," action permission for the object ",(0,o.kt)("inlineCode",{parentName:"li"},"avatar.jpg")," to Alice, it will store a ",(0,o.kt)("inlineCode",{parentName:"li"},"key 0x11 | ResourceID(\nprofile_avatar.jpg) | Address(Alice)")," into a permission state tree;"),(0,o.kt)("li",{parentName:"ul"},"when Alice wants to read the ",(0,o.kt)("inlineCode",{parentName:"li"},"avatar.jpg"),", the SP should check the Greenfield blockchain that whether the ",(0,o.kt)("inlineCode",{parentName:"li"},"key Prefix(\nObjectPermission) | ResourceID(profile_avatar.jpg) | Address(Alice)")," existed in the permission state tree, and whether\nthe action list contains GetObject.")),(0,o.kt)("p",null,"Let's move on to more complex scenarios:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Bob created a bucket named "profile";'),(0,o.kt)("li",{parentName:"ul"},"Bob grants the ",(0,o.kt)("inlineCode",{parentName:"li"},"PutObject"),' action permission for the bucket "profile" to Alice, the key ',(0,o.kt)("inlineCode",{parentName:"li"},"0x10 | ResourceID(profile) |\nAddress(Alice)")," will be put into the permission state tree;"),(0,o.kt)("li",{parentName:"ul"},"When Alice wants to upload an object named ",(0,o.kt)("inlineCode",{parentName:"li"},"avatar.jpg")," into the bucket profile, it creates a ",(0,o.kt)("inlineCode",{parentName:"li"},"PutObject")," transaction and\nwill be executed on the chain;"),(0,o.kt)("li",{parentName:"ul"},"The Greenfield blockchain needs to confirm that Alice has permission to operate, so it checks whether the key ",(0,o.kt)("inlineCode",{parentName:"li"},"0x10 |\nResourceID(profile) | Address(Alice)")," existed in the permission state tree and got the permission information if it\nexisted;"),(0,o.kt)("li",{parentName:"ul"},"If the permission info shows that Alice has the ",(0,o.kt)("inlineCode",{parentName:"li"},"PutObject")," action permission of the bucket profile, then she can do\n",(0,o.kt)("inlineCode",{parentName:"li"},"PutObject")," operation.")),(0,o.kt)("p",null,"Another more complex scenario that contains groups:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Bob creates a group named "Games", and creates a bucket named "profile".'),(0,o.kt)("li",{parentName:"ul"},"Bob adds Alice to the Games group, the ",(0,o.kt)("inlineCode",{parentName:"li"},"key 0x12 | ResourceID(Games) | Address(Alice)")," will be put into the permission\nstate tree"),(0,o.kt)("li",{parentName:"ul"},"Bob put a picture ",(0,o.kt)("inlineCode",{parentName:"li"},"avatar.jpg")," to the bucket profile and grants the ",(0,o.kt)("inlineCode",{parentName:"li"},"CopyObject")," action permission to the group Games"),(0,o.kt)("li",{parentName:"ul"},"When Alice wants to copy the object avatar.jpg . First, Greenfield blockchain checks whether she has permission via the\n",(0,o.kt)("inlineCode",{parentName:"li"},"key 0x11 | ResourceID(avatar.jpg) | Address(Alice)"),"; if it is a miss, Greenfield will iterate all groups that the object\n",(0,o.kt)("inlineCode",{parentName:"li"},"avatar.jpg "),"associates and check whether Alice is a member of one of these groups by checking, e.g. if the\n",(0,o.kt)("inlineCode",{parentName:"li"},"key 0x21 | ResourceID(group, e.g. Games)")," existed, then iterate the ",(0,o.kt)("inlineCode",{parentName:"li"},"permissionInfo")," map, and determine if Alice is in a group which\nhas the permission to do ",(0,o.kt)("inlineCode",{parentName:"li"},"CopyObject")," operation via the key ",(0,o.kt)("inlineCode",{parentName:"li"},"0x12| ResourceID(Games) | Address(Alice)"))),(0,o.kt)("h2",{id:"state"},"State"),(0,o.kt)("p",null,"The permission module keeps state of the following primary objects:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"Policy"),": The owner account of the resource grant its specify permission to another account;"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("inlineCode",{parentName:"li"},"PolicyGroup"),": A limited list of ",(0,o.kt)("inlineCode",{parentName:"li"},"Policy"),", and each ",(0,o.kt)("inlineCode",{parentName:"li"},"Policy")," items defines the owner account of the resource grant\nits specify permission to a group.")),(0,o.kt)("p",null,"These primary objects should be primarily stored and accessed by the ",(0,o.kt)("inlineCode",{parentName:"p"},"ID")," which is an auto-incremented sequence. An\nadditional indices are maintained per primary objects in order to compatibility with the S3 object storage."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"BucketPolicyForAccount: ",(0,o.kt)("inlineCode",{parentName:"li"},"0x11 | BigEndian(BucketID) | AccAddress -> BigEndian(PolicyID)")),(0,o.kt)("li",{parentName:"ul"},"ObjectPolicyForAccount: ",(0,o.kt)("inlineCode",{parentName:"li"},"0x12 | BigEndian(ObjectID) | AccAddress -> BigEndian(PolicyID)")),(0,o.kt)("li",{parentName:"ul"},"GroupPolicyForAccount: ",(0,o.kt)("inlineCode",{parentName:"li"},"0x13 | BigEndian(GroupID) | AccAddress -> BigEndian(PolicyID)")),(0,o.kt)("li",{parentName:"ul"},"BucketPolicyForGroup: ",(0,o.kt)("inlineCode",{parentName:"li"},"0x21 | BigEndian(BucketID) -> ProtoBuf(PolicyGroup)")),(0,o.kt)("li",{parentName:"ul"},"ObjectPolicyForGroup: ",(0,o.kt)("inlineCode",{parentName:"li"},"0x22 | BigEndian(ObjectID) -> ProtoBuf(PolicyGroup)")),(0,o.kt)("li",{parentName:"ul"},"PolicyByID: ",(0,o.kt)("inlineCode",{parentName:"li"},"0x31 | BigEndian(PolicyID) -> ProtoBuf(Policy)"))),(0,o.kt)("h3",{id:"policy"},"Policy"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},'message Policy {\n  string id = 1 [\n    (cosmos_proto.scalar) = "cosmos.Uint",\n    (gogoproto.customtype) = "Uint",\n    (gogoproto.nullable) = false\n  ];\n  permission.Principal principal = 2;\n  resource.ResourceType resource_type = 3;\n  string resource_id = 4 [\n    (cosmos_proto.scalar) = "cosmos.Uint",\n    (gogoproto.customtype) = "Uint",\n    (gogoproto.nullable) = false\n  ];\n  repeated permission.Statement statements = 5;\n  permission.Statement member_statement = 6;\n}\n')),(0,o.kt)("h3",{id:"policygroup"},"PolicyGroup"),(0,o.kt)("p",null,"Each resource can only grant permissions to a limited number of groups and limited number is defined\nby ",(0,o.kt)("inlineCode",{parentName:"p"},"MaximumGroupNum")," in module params."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},'message PolicyGroup {\n  message Item {\n    string policy_id = 1 [\n      (cosmos_proto.scalar) = "cosmos.Uint",\n      (gogoproto.customtype) = "Uint",\n      (gogoproto.nullable) = false\n    ];\n    string group_id = 2 [\n      (cosmos_proto.scalar) = "cosmos.Uint",\n      (gogoproto.customtype) = "Uint",\n      (gogoproto.nullable) = false\n    ];\n  }\n  repeated Item items = 1;\n}\n')),(0,o.kt)("h3",{id:"params"},"params"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},"// Params defines the parameters for the module.\nmessage Params {\n  option (gogoproto.goproto_stringer) = false;\n\n  uint64 maximum_statements_num = 1;\n  uint64 maximum_group_num = 2;\n}\n")),(0,o.kt)("h2",{id:"message"},"Message"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Notice: Permission-related messages are defined in the storage module")),(0,o.kt)("h3",{id:"putpolicy"},"PutPolicy"),(0,o.kt)("p",null,"Used to create a policy for a resource."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},'message MsgPutPolicy {\n  option (cosmos.msg.v1.signer) = "operator";\n\n  // operator defines the granter who grant the permission to another principal\n  string operator = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n\n  // Principal define the roles that can grant permissions. Currently, it can be account or group.\n  permission.Principal principal = 2;\n\n  // resource define a greenfield standard resource name that can be generated by GRN structure\n  string resource = 3;\n\n  // statements define a list of individual statement which describe the detail rules of policy\n  repeated permission.Statement statements = 4;\n}\n')),(0,o.kt)("h3",{id:"deletepolicy"},"DeletePolicy"),(0,o.kt)("p",null,"Used to delete the policy that is associated with an account, group, and resource."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},'message MsgDeletePolicy {\n  option (cosmos.msg.v1.signer) = "operator";\n\n  // operator defines the granter who grant the permission to another principal\n  string operator = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];\n\n  // Principal define the roles that can grant permissions. Currently, it can be account or group.\n  permission.Principal principal = 2;\n\n  // resource define a greenfield standard resource name that can be generated by GRN structure\n  string resource = 3;\n}\n')))}u.isMDXComponent=!0}}]);