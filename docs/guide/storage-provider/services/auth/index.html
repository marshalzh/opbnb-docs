<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide/storage-provider/services/auth">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Auth | BNB Optimistic Rollup</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/storage-provider/services/auth"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Auth | BNB Optimistic Rollup"><meta data-rh="true" name="description" content="Abstract"><meta data-rh="true" property="og:description" content="Abstract"><link data-rh="true" rel="icon" href="/opbnb-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/storage-provider/services/auth"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/storage-provider/services/auth" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/storage-provider/services/auth" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/opbnb-docs/blog/rss.xml" title="BNB Optimistic Rollup RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/opbnb-docs/blog/atom.xml" title="BNB Optimistic Rollup Atom Feed"><link rel="stylesheet" href="/opbnb-docs/assets/css/styles.cbba8081.css">
<link rel="preload" href="/opbnb-docs/assets/js/runtime~main.caf89853.js" as="script">
<link rel="preload" href="/opbnb-docs/assets/js/main.29781c01.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/opbnb-docs/"><div class="navbar__logo"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--light_HNdA"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">BNB Optimistic Rollup</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_BDYx"><div class="docItemContainer_oq1c"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12"><h1>Greenfield Storage Provider Off-Chain Authentication</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="abstract">Abstract<a class="hash-link" href="#abstract" title="Direct link to heading">​</a></h2><p>This document outlines an off-chain authentication specification for greenfield storage providers (SPs) and clients. The specification includes a full functional workflow and a reference implementation, making it easy for any application integrating with greenfield SPs to build an off-chain authentication mechanism.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="motivation">Motivation<a class="hash-link" href="#motivation" title="Direct link to heading">​</a></h2><p>Applications based on the greenfield chain often need to interact with multiple greenfield SPs, which are off-chain services that require users to use Ethereum-compatible accounts to represent their identities.</p><p>For most interactions between applications and SPs, users&#x27; identities are required. Typically, applications can use message signing via account private keys to authenticate users, as long as they have access to their private keys. However, for browser-based applications, accessing the end users&#x27; private keys directly is not possible, making it necessary to prompt users to sign messages for each off-chain request between applications and SPs. This results in a poor user experience.</p><p>This document describes a workflow to address this problem.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="workflow">WorkFlow<a class="hash-link" href="#workflow" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="overall-workflow">Overall workflow<a class="hash-link" href="#overall-workflow" title="Direct link to heading">​</a></h3><p><img loading="lazy" alt="auth-workflow" src="/opbnb-docs/assets/images/015-Auth-Overview-4661affcfe015a476aef678cc475e0dd.png" width="722" height="839" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1---generate-eddsa-key-pairs-in-apps">Step 1 - Generate EdDSA key pairs in Apps<a class="hash-link" href="#step-1---generate-eddsa-key-pairs-in-apps" title="Direct link to heading">​</a></h3><p>Applications can design how to generate EdDSA key pairs themselves, and SPs do not have any restrictions on it.</p><p>Here is one example.</p><ol><li>For each Ethereum address, the SP counts how many times the account public key has been updated for a given app domain since registration. This value is called the &quot;key nonce&quot; and denoted as n. It starts from 0 and increments by 1 after each successful account public key update. The app can invoke the <strong>SP API &quot;request_nonce&quot;</strong> to retrieve the nonce value n. A simple request to get the nonce is:</li></ol><div class="language-sh codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sh codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location &#x27;https://${SP_API_ADDRESS}/auth/request_nonce&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-User-Address: 0x3d0a49B091ABF8940AD742c0139416cEB30CdEe0&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-App-Domain: https://greenfield_app1.domain.com&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The response is:</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;current_nonce&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;next_nonce&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;current_public_key&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;expiry_date&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since we are trying to build a new key pairs, we will use next_nonce value as n.</p><ol start="2"><li>The app puts <code>n</code> and <code>sp addresses</code> into a constant strings:</li></ol><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Sign this message to let dapp ${dapp_domain} access the following SPs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- SP ${SP_ADDRESS_1} (name:${SP_NAME_1}) with nonce:${NONCE_1}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">- SP ${SP_ADDRESS_2} (name:${SP_NAME_2}) with nonce:${NONCE_2}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We denote the new string as <code>M</code></p><ol start="3"><li><p>The app then requests the user to sign M with their Ethereum ECDSA private key, then gets the signature S.</p></li><li><p>The app uses sha256(S) as the seed to generate the EdDSA key pairs EdDSA_private_K and EdDSA_public_K.</p></li><li><p>The app saves EdDSA_private_K as plain text in the browser&#x27;s session storage and registers EdDSA_public_K as the account public key into the SP servers.</p></li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2---register-eddsa-public-key-in-sps">Step 2 - Register EdDSA public key in SPs<a class="hash-link" href="#step-2---register-eddsa-public-key-in-sps" title="Direct link to heading">​</a></h3><p>For each combination of user address and app domain, the SP backend maintains a key nonce <code>n</code>. It starts from 0 and increments by 1 after each successful account key update.</p><p>To register an account public key into a certain SP, you can invoke <a href="https://greenfield.bnbchain.org/docs/api-sdk/storgae-provider-rest/auth/update_key.html" target="_blank" rel="noopener noreferrer">SP API &quot;update<!-- -->_<!-- -->key&quot;</a>.</p><p>Here is an example. Suppose that</p><ol><li>The <strong>user account address</strong> is <code>0x3d0a49B091ABF8940AD742c0139416cEB30CdEe0</code></li><li>The <strong>app domain</strong> is <code>https://greenfield_app1.domain.com</code></li><li>The <strong>nonce</strong> for above user address and app domain from <a href="https://greenfield.bnbchain.org/docs/api-sdk/storgae-provider-rest/auth/get_nonce.html" target="_blank" rel="noopener noreferrer">SP API &quot;request<!-- -->_<!-- -->nonce&quot;</a> is <code>1</code></li><li>The <strong>SP operator address</strong> is <code>0x70d1983A9A76C8d5d80c4cC13A801dc570890819</code></li><li>The <strong>EdDSA<!-- -->_<!-- -->public<!-- -->_<!-- -->K</strong> is <code>4db642fe6bc2ceda2e002feb8d78dfbcb2879d8fe28e84e02b7a940bc0440083</code></li><li>The <strong>expiry time</strong> for this <code>EdDSA_public_K</code> is <code>2023-04-28T16:25:24Z</code>. The expiry time indicates the expiry time of this <code>EdDSA_public_K</code> , which should be a future time and within <strong>7 days.</strong></li></ol><p>The app will put above information into a text message:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">https://greenfield_app1.domain.com wants you to sign in with your BNB Greenfield account:\n0x3d0a49B091ABF8940AD742c0139416cEB30CdEe0\n\nRegister your identity public key 4db642fe6bc2ceda2e002feb8d78dfbcb2879d8fe28e84e02b7a940bc0440083\n\nURI: https://greenfield_app1.domain.com\nVersion: 1\nChain ID: 5600\nIssued At: 2023-04-24T16:25:24Z\nExpiration Time: 2023-04-28T16:25:24Z\nResources:\n- SP 0x70d1983A9A76C8d5d80c4cC13A801dc570890819 (name: SP_001) with nonce: 1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We denote this text message as <code>M2</code></p><p>and request user to sign and get the signature<code>S2</code>:</p><p><img loading="lazy" alt="auth-update-key-metamask" src="/opbnb-docs/assets/images/015-Auth-Update-Key-Metamask-961fcbc2e43767074df471e63c9e7285.png" width="1102" height="1804" class="img_ev3q"></p><p>Finally, the app invokes <a href="https://greenfield.bnbchain.org/docs/api-sdk/storgae-provider-rest/auth/update_key.html" target="_blank" rel="noopener noreferrer">SP API &quot;update<!-- -->_<!-- -->key&quot;</a> by putting <code>S2</code> into http Authorization header. The following is an example:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location --request POST &#x27;https://${SP_API_ADDRESS}/auth/update_key&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Origin: https://greenfield_app1.domain.com&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-App-Domain: https://greenfield_app1.domain.com&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-App-Reg-Nonce: 1&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-App-Reg-Public-Key: 4db642fe6bc2ceda2e002feb8d78dfbcb2879d8fe28e84e02b7a940bc0440083&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-App-Reg-Expiry-Date: 2023-04-28T16:25:24Z&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;Authorization: PersonalSign ECDSA-secp256k1,SignedMsg=https://greenfield_app1.domain.com wants you to sign in with your BNB Greenfield account:\n0x3d0a49B091ABF8940AD742c0139416cEB30CdEe0\n\nRegister your identity public key 4db642fe6bc2ceda2e002feb8d78dfbcb2879d8fe28e84e02b7a940bc0440083\n\nURI: https://greenfield_app1.domain.com\nVersion: 1\nChain ID: 5600\nIssued At: 2023-04-24T16:25:24Z\nExpiration Time: 2023-04-28T16:25:24Z\nResources:\n- SP 0x70d1983A9A76C8d5d80c4cC13A801dc570890819 (name: SP_001) with nonce: 1,Signature=0x8663c48cfecb611d64540d3b653f51ef226f3f674e2c390ea9ca45746b22a4f839a15576b5b4cc1051183ae9b69ac54160dc3241bbe99c695a52fe25eaf2f8c01b&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the response code returns 200, you can check if the new account public key is saved into this SP by invoking <a href="https://greenfield.bnbchain.org/docs/api-sdk/storgae-provider-rest/auth/get_nonce.html" target="_blank" rel="noopener noreferrer">SP API &quot;request<!-- -->_<!-- -->nonce&quot;</a>
This API returns the latest key nonce for a given user address and app domain.</p><p>If the API returns the new key nonce, the account public key has been successfully registered into the SP servers. The app can now use the EdDSA key pair generated in Step 1 to authenticate the user in future interactions with the SP.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-3---use-eddsa-seed-to-sign-request-and-verification">Step 3 - Use EdDSA seed to sign request and verification<a class="hash-link" href="#step-3---use-eddsa-seed-to-sign-request-and-verification" title="Direct link to heading">​</a></h3><p>In Step1 &amp; Step2, we generated EdDSA keys and registered them into SP. In Step3, we can use <code>EdDSA_private_K</code> to sign request when an app invokes a certain SP API.</p><p>To sign a request, the app needs to define a customized text message with a recent expiry timestamp (denoted as <code>EdDSA_M</code>) and use <code>EdDSA_private_K</code> to sign this message to get the signature <code>EdDSA_S</code>.</p><p>The text message format is <code>${actionContent}_${expiredTimestamp}</code>.</p><p>For example, if a user clicks the &quot;download&quot; button in an app to download a private object they own, this will invoke the SP getObject API.
The <code>EdDSA_M</code> could be defined as <code>Invoke_GetObject_1682407345000</code>, and the <code>EdDSA_S</code> would be <code>a48fff140b148369a108611502acff919720b5493aa36ba0886d8d73634ee20404963b847104d06aa822cf904741aff70ede4ba7d70fa8808c3206d4c93be623</code>.</p><p>To combine <code>EdDSA_M</code> and <code>EdDSA_S</code>, the app should include them in the Authorization header when invoking the GetObject API:</p><div class="language-plain codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-plain codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl --location &#x27;https://${SP_API_ADDRESS}/${bucket_name}/${object_name}&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;authorization: OffChainAuth EDDSA,SignedMsg=Invoke_GetObject_1682407345000,Signature=a48fff140b148369a108611502acff919720b5493aa36ba0886d8d73634ee20404963b847104d06aa822cf904741aff70ede4ba7d70fa8808c3206d4c93be623&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-User-Address: 0x3d0a49B091ABF8940AD742c0139416cEB30CdEe0&#x27; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--header &#x27;X-Gnfd-App-Domain: https://greenfield_app1.domain.com&#x27; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>By including the signed message and signature in the Authorization header, the app can authenticate the request with the SP servers. The SP servers can then verify the signature using the EdDSA_public_K registered in Step 2.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-4---manage-eddsa-key-pairs">Step 4 - Manage EdDSA key pairs<a class="hash-link" href="#step-4---manage-eddsa-key-pairs" title="Direct link to heading">​</a></h3><p>Although we defined an expiry date for registered <code>EdDSA_public_K</code>, users might want to know how many EdDSA keys they are currently using and might want to delete them for security concerns.</p><p>To list a user&#x27;s registered EdDSA account public keys in an SP, apps can invoke <a href="https://greenfield.bnbchain.org/docs/api-sdk/storgae-provider-rest/auth/list_key.html" target="_blank" rel="noopener noreferrer">SP API &quot;list<!-- -->_<!-- -->key&quot;</a>.
To delete a user&#x27;s registered EdDSA account public key in an SP, apps can invoke  <a href="https://greenfield.bnbchain.org/docs/api-sdk/storgae-provider-rest/auth/delete_key.html" target="_blank" rel="noopener noreferrer">SP API &quot;delete<!-- -->_<!-- -->key&quot;</a></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="auth-api-specification">Auth API Specification<a class="hash-link" href="#auth-api-specification" title="Direct link to heading">​</a></h3><p>See <a href="https://greenfield.bnbchain.org/docs/api-sdk/storgae-provider-rest/auth" target="_blank" rel="noopener noreferrer">SP Auth Rest API Doc</a> </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rational">Rational<a class="hash-link" href="#rational" title="Direct link to heading">​</a></h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="security-considerations">Security Considerations<a class="hash-link" href="#security-considerations" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="preventing-replay-attacks">Preventing replay attacks<a class="hash-link" href="#preventing-replay-attacks" title="Direct link to heading">​</a></h3><p>To prevent replay attacks, which are man-in-the-middle attacks in which an attacker is able to capture the user&#x27;s signature and resend it to establish a new session for themselves, the following measures should be taken:</p><ul><li><p>A new <code>nonce</code> should be selected each time when EdDSA keys are generated. This ensures that each generated key pair is unique and cannot be replayed.</p></li><li><p>When using EdDSA_private_K to sign a request, a recent timestamp as the expiry date must be included. This ensures that the signed message is only valid for a limited time and cannot be reused in a replay attack.</p></li></ul><p>By implementing these measures, the app can minimize the risk of replay attacks and ensure the security of the user&#x27;s data and interactions with the SP servers.</p></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bnb-chain/opbnb-docs/docs/guide/storage-provider/services/auth.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#abstract" class="table-of-contents__link toc-highlight">Abstract</a></li><li><a href="#motivation" class="table-of-contents__link toc-highlight">Motivation</a></li><li><a href="#workflow" class="table-of-contents__link toc-highlight">WorkFlow</a><ul><li><a href="#overall-workflow" class="table-of-contents__link toc-highlight">Overall workflow</a></li><li><a href="#step-1---generate-eddsa-key-pairs-in-apps" class="table-of-contents__link toc-highlight">Step 1 - Generate EdDSA key pairs in Apps</a></li><li><a href="#step-2---register-eddsa-public-key-in-sps" class="table-of-contents__link toc-highlight">Step 2 - Register EdDSA public key in SPs</a></li><li><a href="#step-3---use-eddsa-seed-to-sign-request-and-verification" class="table-of-contents__link toc-highlight">Step 3 - Use EdDSA seed to sign request and verification</a></li><li><a href="#step-4---manage-eddsa-key-pairs" class="table-of-contents__link toc-highlight">Step 4 - Manage EdDSA key pairs</a></li><li><a href="#auth-api-specification" class="table-of-contents__link toc-highlight">Auth API Specification</a></li></ul></li><li><a href="#rational" class="table-of-contents__link toc-highlight">Rational</a></li><li><a href="#security-considerations" class="table-of-contents__link toc-highlight">Security Considerations</a><ul><li><a href="#preventing-replay-attacks" class="table-of-contents__link toc-highlight">Preventing replay attacks</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"></div></footer></div>
<script src="/opbnb-docs/assets/js/runtime~main.caf89853.js"></script>
<script src="/opbnb-docs/assets/js/main.29781c01.js"></script>
</body>
</html>