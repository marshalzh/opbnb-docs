<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide/dapp/dapp-integration">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Contract SDK | BNB Optimistic Rollup</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/dapp/dapp-integration"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Contract SDK | BNB Optimistic Rollup"><meta data-rh="true" name="description" content="The Smart Contract SDK,"><meta data-rh="true" property="og:description" content="The Smart Contract SDK,"><link data-rh="true" rel="icon" href="/opbnb-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/dapp/dapp-integration"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/dapp/dapp-integration" hreflang="en"><link data-rh="true" rel="alternate" href="https://your-docusaurus-test-site.com/opbnb-docs/docs/guide/dapp/dapp-integration" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/opbnb-docs/blog/rss.xml" title="BNB Optimistic Rollup RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/opbnb-docs/blog/atom.xml" title="BNB Optimistic Rollup Atom Feed"><link rel="stylesheet" href="/opbnb-docs/assets/css/styles.cbba8081.css">
<link rel="preload" href="/opbnb-docs/assets/js/runtime~main.caf89853.js" as="script">
<link rel="preload" href="/opbnb-docs/assets/js/main.29781c01.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/opbnb-docs/"><div class="navbar__logo"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--light_HNdA"><img src="/opbnb-docs/img/logo.svg" alt="BNB Optimistic Rollup" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">BNB Optimistic Rollup</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_BDYx"><div class="docItemContainer_oq1c"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12"><h1>Contract SDK</h1><p>The <a href="https://github.com/bnb-chain/greenfield-contracts-sdk" target="_blank" rel="noopener noreferrer">Smart Contract SDK</a>,
designed to facilitate the development of community-driven projects. The SDK serves as an upper layer wrapper for the
<a href="https://github.com/bnb-chain/greenfield-contracts" target="_blank" rel="noopener noreferrer">Greenfield-Contracts</a> library, which implements the cross-chain
communication functionality. By providing a user-friendly interface to the underlying interface, the SDK simplifies the
development process and enables developers to create and manage a variety of greenfield resources, like bucket,
group, and object on BSC through smart contract directly.</p><p>The SDK is organized into four primary parts: <code>BaseApp</code>, <code>BucketApp</code>, <code>ObjectApp</code>, and <code>GroupApp</code>.
These components serve as the building blocks for developers. The <code>BaseApp</code> serves as the foundation for the other three
components, providing common functions required by the <code>BucketApp</code>, <code>ObjectApp</code>, and <code>GroupApp</code>.</p><p>The <code>BucketApp</code> is responsible for managing bucket-related operations, while the <code>ObjectApp</code> handles object-related actions.
The <code>GroupApp</code>, being the most complex of the four, is designed to handle group-related operations.</p><p>Each of these components is equipped with unique functions and virtual functions that can be implemented to suit specific project needs.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="components">Components<a class="hash-link" href="#components" title="Direct link to heading">​</a></h3><ol><li><strong>BaseApp:</strong> Contains common functions used by the other components, as well as three virtual functions that need to be implemented for specific project requirements.</li><li><strong>BucketApp:</strong> A specialized module designed to handle bucket-related operations, such as creating and deleting buckets, and processing bucket resource calls.</li><li><strong>ObjectApp:</strong> A specialized module focused on object-related operations, specifically object deletion since creating objects from BSC is not supported.</li><li><strong>GroupApp:</strong> A more complex module that handles group-related operations, such as creating, deleting, and updating groups, and managing group resource calls.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="baseapp">BaseApp<a class="hash-link" href="#baseapp" title="Direct link to heading">​</a></h3><p>The BaseApp contains common functions that are shared by BucketApp, ObjectApp, and GroupApp.
These functions are essential for setting up and managing the environment for cross-chain operations.
The BaseApp provides the following core functions:</p><ol><li><code>_getTotalFee():</code> This function returns the total value required to send a cross-chain package.</li><li><code>Setters:</code> There are several setters available for configuring various aspects of the smart contract, such as:<ul><li><code>callbackGasLimit</code>: Sets the gas limit for the callback function.</li><li><code>refundAddress</code>: Sets the address to which refunds should be sent.</li><li><code>failureHandleStrategy</code>: Sets the strategy for handling failures during the execution of the smart contract.</li></ul></li></ol><p>In addition to these functions, BaseApp provides three virtual functions:</p><ol><li><code>greenfieldCall(uint32 status, uint8 resourceType, uint8 operationType, uint256 resourceId, bytes calldata callbackData):</code>
This function is a callback hook designed to handle cross-chain response. It is a virtual function that needs to be
implemented by developers to define custom behaviors for different types of resources and operation types.
This function is triggered when a cross-chain operation is completed on greenfield side and return a package to bsc,
allowing developers to execute specific actions or update states in response to the completion of an operation.
If the developers don’t need callback, this function(as well as other callback related functions) can be undefined.</li><li><code>retryPackage(uint8 resourceType):</code> This function handles the retry mechanism for a package, based on its resource
type. Developers should implement this function to define the behavior when a package needs to be retried.</li><li><code>skipPackage(uint8 resourceType):</code> This function allows for skipping a package, based on its resource type.
Developers should implement this function to define the behavior when a package needs to be skipped.</li></ol><p>By implementing these virtual functions, developers can customize the behavior of their smart contracts to meet their
specific requirements. With the BaseApp component, developers have a solid foundation on which to build their smart
contract applications using <code>BucketApp</code>, <code>ObjectApp</code>, and <code>GroupApp</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="bucketapp">BucketApp<a class="hash-link" href="#bucketapp" title="Direct link to heading">​</a></h3><p>The BucketApp component is a specialized module designed to handle bucket-related operations in the smart contract SDK.
This component offers a range of functions to create, delete, and manage buckets, as well as to route and handle
various bucket resource operations. Below, we provide a detailed overview of the functions included in the BucketApp:</p><ol><li><code>_bucketGreenfieldCall(uint32 status, uint8 operationType, uint256 resourceId, bytes calldata callbackData)</code>: This function serves as a router for bucket resource callback. It processes and directs the call based on the provided parameters.</li><li><code>_retryBucketPackage()</code>: This function retries a failed bucket resource package.</li><li><code>_skipBucketPackage()</code>: This function skips a failed bucket resource package.</li><li><code>_createBucket(address _creator, string memory _name, BucketStorage.BucketVisibilityType _visibility, uint64 _chargedReadQuota, address _spAddress, uint256 _expireHeight, bytes calldata _sig)</code>: This function sends a create bucket cross-chain request to greenfield without a callback. It takes various parameters, such as creator, name, visibility type, charged read quota, service provider address, expire height, and signature.</li><li><code>_createBucket(address _creator, string memory _name, BucketStorage.BucketVisibilityType _visibility, uint64 _chargedReadQuota, address _spAddress, uint256 _expireHeight, bytes calldata _sig, bytes memory _callbackData)</code>: This function sends a create bucket cross-chain request to greenfield with a callback. It takes the same parameters as the previous function, along with an additional <code>_callbackData</code> parameter for the callback.</li><li><code>_deleteBucket(uint256 _tokenId)</code>: This function sends a delete bucket cross-chain request to greenfield without a callback, using the provided token ID.</li><li><code>_deleteBucket(uint256 _tokenId, bytes memory _callbackData)</code>: This function sends a delete bucket cross-chain request to greenfield with a callback, using the provided token ID and callback data.</li></ol><p>In addition to these functions, the BucketApp provides two virtual functions:</p><ol><li><code>_createBucketCallback(uint32 _status, uint256 _tokenId, bytes memory _callbackData)</code>: Developers can implement this function to define the behavior for the create bucket callback. The function receives the status, token ID, and callback data as parameters.</li><li><code>_deleteBucketCallback(uint32 _status, uint256 _tokenId, bytes memory _callbackData)</code>: Developers can implement this function to define the behavior for the delete bucket callback. The function receives the status, token ID, and callback data as parameters.</li></ol><p>By implementing these virtual functions, developers can tailor the BucketApp component to suit their specific bucket-related operations and handle the corresponding callbacks as needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="objectapp">ObjectApp<a class="hash-link" href="#objectapp" title="Direct link to heading">​</a></h3><p>The ObjectApp component is a specialized module designed to handle object-related operations in the smart contract SDK.
This component offers a range of functions to manage objects and process object resource operations. However, please
note that creating objects from BSC is currently not supported. Below, we provide a detailed overview of the functions
included in the ObjectApp:</p><ol><li><code>_objectGreenfieldCall(uint32 status, uint8 operationType, uint256 resourceId, bytes calldata callbackData)</code>: This function serves as a router for object resource callback. It processes and directs the call based on the provided parameters.</li><li><code>_retryObjectPackage()</code>: This function retries a failed object resource package.</li><li><code>_skipObjectPackage()</code>: This function skips a failed object resource package.</li><li><code>_deleteObject(uint256 _tokenId)</code>: This function deletes an object using the provided token ID. As creating objects from BSC is not supported, the ObjectApp focuses on deletion operations.</li><li><code>_deleteObject(uint256 _tokenId, bytes memory _callbackData)</code>: This function deletes an object with a callback, using the provided token ID and callback data.</li></ol><p>In addition to these functions, the ObjectApp provides one virtual function:</p><ol><li><code>_deleteObjectCallback(uint32 _status, uint256 _tokenId, bytes memory _callbackData)</code>: Developers need to implement
this function to define the behavior for the delete object callback. The function receives the status, token ID,
and callback data as parameters.</li></ol><p>By implementing this virtual function, developers can customize the ObjectApp component to handle object deletion
operations and manage the corresponding callbacks as needed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="groupapp">GroupApp<a class="hash-link" href="#groupapp" title="Direct link to heading">​</a></h3><p>The GroupApp component is a specialized module designed to handle group-related operations in the smart contract SDK.
This component is more complex compared to the BucketApp and ObjectApp, as it offers a range of functions to create,
delete, update, and manage groups. Below, we provide a detailed overview of the functions included in the GroupApp:</p><ol><li><code>_groupGreenfieldCall(uint32 status, uint8 operationType, uint256 resourceId, bytes calldata callbackData)</code>: This function serves as a router for group resource callback. It processes and directs the call based on the provided parameters.</li><li><code>_retryGroupPackage()</code>: This function retries a failed group resource package.</li><li><code>_skipGroupPackage()</code>: This function skips a failed group resource package.</li><li><code>_createGroup(address _owner, string memory _groupName)</code>: This function creates a new group with the provided owner address and group name.</li><li><code>_createGroup(address _owner, string memory _groupName, bytes memory _callbackData)</code>: This function creates a new group with a callback, using the provided owner address, group name, and callback data.</li><li><code>_deleteGroup(uint256 _tokenId)</code>: This function deletes a group using the provided token ID.</li><li><code>_deleteGroup(uint256 _tokenId, bytes memory _callbackData)</code>: This function deletes a group with a callback, using the provided token ID and callback data.</li><li><code>_updateGroup(address _owner, uint256 _tokenId, uint8 _opType, address[] memory _members)</code>: This function updates a group based on the provided owner address, token ID, operation type, and an array of member addresses.</li><li><code>_updateGroup(address _owner, uint256 _tokenId, uint8 _opType, address[] memory _members, bytes memory _callbackData)</code>: This function updates a group with a callback, using the provided owner address, token ID, operation type, an array of member addresses, and callback data.</li></ol><p>In addition to these functions, the GroupApp provides three virtual functions:</p><ol><li><code>_createGroupCallback(uint32 _status, uint256 _tokenId, bytes memory _callbackData)</code>: Developers need to implement this function to define the behavior for the create group callback. The function receives the status, token ID, and callback data as parameters.</li><li><code>_deleteGroupCallback(uint32 _status, uint256 _tokenId, bytes memory _callbackData)</code>: Developers need to implement this function to define the behavior for the delete group callback. The function receives the status, token ID, and callback data as parameters.</li><li><code>_updateGroupCallback(uint32 _status, uint256 _tokenId, bytes memory _callbackData)</code>: Developers need to implement this function to define the behavior for the update group callback. The function receives the status, token ID, and callback data as parameters.</li></ol><p>By implementing these virtual functions, developers can customize the GroupApp component to suit their specific
group-related operations and handle the corresponding callbacks as needed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="integration-example">Integration Example<a class="hash-link" href="#integration-example" title="Direct link to heading">​</a></h2><p>We will walk you through the process of creating a decentralized <code>Ebook</code> shop using the Contract SDK
as an example.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h3><p>Before starting, make sure you have the following tools installed:</p><ul><li><a href="https://nodejs.org/" target="_blank" rel="noopener noreferrer">Node.js</a></li><li><a href="https://book.getfoundry.sh/" target="_blank" rel="noopener noreferrer">Foundry</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installation">Installation<a class="hash-link" href="#installation" title="Direct link to heading">​</a></h3><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ npm install @bnb-chain/greenfield-contracts-sdk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alternatively, you can obtain the contracts directly from the GitHub repository (<code>bnb-chain/greenfield-contracts-sdk</code>). When doing so, ensure that you specify the appropriate release.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps<a class="hash-link" href="#steps" title="Direct link to heading">​</a></h4><ol><li><p>Import the desired contracts, for example in <code>examples/ebook-shop.sol</code>:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pragma solidity ^0.8.0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@bnb-chain/greenfield-contracts-sdk/BucketApp.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@bnb-chain/greenfield-contracts-sdk/ObjectApp.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@bnb-chain/greenfield-contracts-sdk/GroupApp.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@bnb-chain/greenfield-contracts-sdk/interface/IERC1155.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@bnb-chain/greenfield-contracts-sdk/interface/IERC721NonTransferable.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;@bnb-chain/greenfield-contracts-sdk/interface/IERC1155NonTransferable.sol&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">contract EbookShop is BucketApp, ObjectApp, GroupApp {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Define the <code>initialize</code> function. Initialize the global variables in the init function. You can use the internal init functions:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function initialize(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _crossChain,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _bucketHub,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _objectHub,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _groupHub,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _ebookToken,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _paymentAddress,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 _callbackGasLimit,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _refundAddress,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint8 _failureHandleStrategy,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) public initializer {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __base_app_init_unchained(_crossChain, _callbackGasLimit, _refundAddress, _failureHandleStrategy);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __bucket_app_init_unchained(_bucketHub, _paymentAddress);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __group_app_init_unchained(_groupHub);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    __object_app_init_unchained(_objectHub);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Define and override the <code>greenfieldCall</code>, <code>retryPackage</code> and <code>skipPackage</code> functions if your dApp needs callback. You can route calls with the help of the internal method:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function greenfieldCall(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint32 status,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint8 resoureceType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint8 operationType,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 resourceId,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes calldata callbackData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) external override(BucketApp, ObjectApp, GroupApp) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(msg.sender == crossChain, string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_CALLER));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (resoureceType == RESOURCE_BUCKET) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _bucketGreenfieldCall(status, operationType, resourceId, callbackData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (resoureceType == RESOURCE_OBJECT) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _objectGreenfieldCall(status, operationType, resourceId, callbackData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (resoureceType == RESOURCE_GROUP) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _groupGreenfieldCall(status, operationType, resourceId, callbackData);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        revert(string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_RESOURCE));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function retryPackage(uint8 resoureceType) external override onlyOperator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (resoureceType == RESOURCE_BUCKET) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _retryBucketPackage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (resoureceType == RESOURCE_OBJECT) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _retryObjectPackage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (resoureceType == RESOURCE_GROUP) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _retryGroupPackage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        revert(string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_RESOURCE));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function skipPackage(uint8 resoureceType) external override onlyOperator {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (resoureceType == RESOURCE_BUCKET) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _skipBucketPackage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (resoureceType == RESOURCE_OBJECT) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _skipObjectPackage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else if (resoureceType == RESOURCE_GROUP) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        _skipGroupPackage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        revert(string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_RESOURCE));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Next you need to define the main functional parts of the app. You can send cross-chain request to system contracts with the help of internal functions like below:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @dev Create a new series.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Assuming the sp provider&#x27;s info will be provided by the front-end.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function createSeries(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string calldata name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    BucketStorage.BucketVisibilityType visibility,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint64 chargedReadQuota,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address spAddress,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 expireHeight,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes calldata sig</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">) external payable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(bytes(name).length &gt; 0, string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_NAME));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(seriesId[name] == 0, string.concat(&quot;EbookShop: &quot;, ERROR_RESOURCE_EXISTED));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bytes memory _callbackData = bytes(name); // use name as callback data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _createBucket(msg.sender, name, visibility, chargedReadQuota, spAddress, expireHeight, sig, _callbackData); // send cross-chain request</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @dev Provide an ebook&#x27;s ID to publish it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * An ERC1155 token will be minted to the owner.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Other users can buy the ebook by calling `buyEbook` function with given price.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function publishEbook(uint256 _ebookId, uint256 price) external {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IERC721NonTransferable(objectToken).ownerOf(_ebookId) == msg.sender,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_CALLER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(ebookGroup[_ebookId] != 0, string.concat(&quot;EbookShop: &quot;, ERROR_GROUP_NOT_EXISTED));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(price &gt; 0, string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_PRICE));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ebookPrice[_ebookId] = price;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IERC1155(ebookToken).mint(msg.sender, _ebookId, 1, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @dev Provide an ebook&#x27;s ID to buy it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Buyer will be added to the group of the ebook.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * An ERC1155 token will be minted to the buyer.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function buyEbook(uint256 _ebookId) external payable {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(ebookPrice[_ebookId] &gt; 0, string.concat(&quot;EbookShop: &quot;, ERROR_EBOOK_NOT_ONSHELF));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 price = ebookPrice[_ebookId];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(msg.value &gt;= price, string.concat(&quot;EbookShop: &quot;, ERROR_NOT_ENOUGH_VALUE));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    IERC1155(ebookToken).mint(msg.sender, _ebookId, 1, &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uint256 _groupId = ebookGroup[_ebookId];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address _owner = IERC721NonTransferable(groupToken).ownerOf(_groupId);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    address[] memory _member = new address[](1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _member[0] = msg.sender;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    _updateGroup(_owner, _groupId, UPDATE_ADD, _member);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @dev Provide an ebook&#x27;s ID to downshelf it.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * The ebook will be removed from the shelf and cannot be bought.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * Those who have already purchased are not affected.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function downshelfEbook(uint256 _ebookId) external {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IERC721NonTransferable(objectToken).ownerOf(_ebookId) == msg.sender,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_CALLER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(ebookPrice[_ebookId] &gt; 0, string.concat(&quot;EbookShop: &quot;, ERROR_EBOOK_NOT_ONSHELF));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ebookPrice[_ebookId] = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Besides, you may need to provide a function for user to register their own resource that were created at greenfield side and then mirrored to BSC manually:</p><div class="language-solidity codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-solidity codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/**</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * @dev Register bucket resource that mirrored from GreenField to BSC.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function registerSeries(string calldata name, uint256 tokenId) external {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IERC721NonTransferable(bucketToken).ownerOf(tokenId) == msg.sender,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_CALLER)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(bytes(name).length &gt; 0, string.concat(&quot;EbookShop: &quot;, ERROR_INVALID_NAME));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    require(seriesId[name] == 0, string.concat(&quot;EbookShop: &quot;, ERROR_RESOURCE_EXISTED));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seriesName[tokenId] = name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    seriesId[name] = tokenId;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>Define other view functions, internal funcions and access control system according to your own needs.</p></li></ol></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bnb-chain/opbnb-docs/docs/guide/dapp/dapp-integration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#components" class="table-of-contents__link toc-highlight">Components</a></li><li><a href="#baseapp" class="table-of-contents__link toc-highlight">BaseApp</a></li><li><a href="#bucketapp" class="table-of-contents__link toc-highlight">BucketApp</a></li><li><a href="#objectapp" class="table-of-contents__link toc-highlight">ObjectApp</a></li><li><a href="#groupapp" class="table-of-contents__link toc-highlight">GroupApp</a></li><li><a href="#integration-example" class="table-of-contents__link toc-highlight">Integration Example</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"></div></footer></div>
<script src="/opbnb-docs/assets/js/runtime~main.caf89853.js"></script>
<script src="/opbnb-docs/assets/js/main.29781c01.js"></script>
</body>
</html>